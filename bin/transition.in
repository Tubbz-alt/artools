#!/bin/bash

# alias git=hub

super_repo=/home/artux/artools-workspace/artix/packages

copy_pkgs(){
    for repo in system world;do
        local old_repo=/home/artux/artools-workspace/artix/$repo
        cd $old_repo
        local packages=$(find . -mindepth 1 -maxdepth 1 -type d)
       # git checkout testing
        for p in ${packages[@]};do
            local pkg=${p#*/}             
            mkdir -p $super_repo/$pkg/$repo
        #     cp -v $pkg/* $super_repo/$pkg/trunk/
            cp -v $pkg/* $super_repo/$pkg/$repo/
        done
    done
    rm -r $super_repo/.git
}

create_pkg_repo(){
    cd $super_repo
    local packages=$(find . -mindepth 1 -maxdepth 1 -type d)
    for p in ${packages[@]};do
        local pkg=${p#*/} 
        cd $pkg
        git init
        git add .
        git commit -m "initial commit $pkg"
        hub create artix-packages/$pkg
        git push origin master
        cd ..
    done
}

add_pkg_subtree(){
    for repo in system world;do
        local old_repo=/home/artux/artools-workspace/artix/$repo
        cd $old_repo
        local packages=$(find . -mindepth 1 -maxdepth 1 -type d)
        cd $super_repo
        for p in ${packages[@]};do
            local pkg=${p#*/} 
            git remote add -f $pkg git@github.com:artix-packages/$pkg.git
            git subtree add --prefix $pkg $pkg master --squash
#             git subtree add --prefix $pkg git@github.com:artix-packages/$pkg.git master --squash
        done
    done
}

# copy_pkgs
# create_pkg_repo
add_pkg_subtree
